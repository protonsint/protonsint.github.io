<!DOCTYPE html>
<html lang="en">
<head>
  <title>IndiStocks - NSE BHAVCopy</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  

	<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.13/css/dataTables.bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/yadcf/0.9.1/jquery.dataTables.yadcf.min.css" />
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/nseFilter.css">
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.2.0/papaparse.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.13/js/jquery.dataTables.min.js"></script> 
	<script src="https://cdnjs.cloudflare.com/ajax/libs/yadcf/0.9.1/jquery.dataTables.yadcf.min.js"></script>
	<script src="js/init.js"></script>
	<script src="js/bhavcopyfilter.js"></script>  -->


	
	<link rel="stylesheet" href="css/bootstrap.min.css" />
	<link rel="stylesheet" href="css/jquery-ui.min.css" />
	<link rel="stylesheet" href="css/dataTables.bootstrap.min.css">
	<link rel="stylesheet" href="css/jquery.dataTables.yadcf.min.css" />
	<link rel="stylesheet" href="css/style.css">
	<!-- <link rel="stylesheet" href="css/nseFilter.css"> -->
	
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery-ui.min.js"></script>
	<script src="js/papaparse.min.js"></script>
	<script src="js/jquery.dataTables.min.js"></script> 
	<script src="js/jquery.dataTables.yadcf.min.js"></script>
	<script src="js/init.js"></script>
	<script>
	
	
	
	
	var getColorForPercentage = function(pct) {
	var cfac=(Math.abs(pct)/5);
	var ccode=0;
	if(pct<0)
		ccode='rgba(255,0,0,'+cfac+')';
	else
		ccode='rgba(0,255,0,'+cfac+')';

	return ccode;
}
		



		  
$(function()
{

$( "#datepicker" ).datepicker( {dateFormat: "ddMyy"});
//$( "#datepicker" ).datepicker( {dateFormat: "ddmmyy"});
$( "#datepicker2" ).datepicker( {dateFormat: "ddMyy"});

$('#getbhav').click(function(e) {
		//var str=$('#datepicker').val();
		//var res = str.toUpperCase() ;
		var selDate=$( "#datepicker" ).datepicker( "getDate" ).getDate();
		var monthNames = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN","JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
		var selYear=$( "#datepicker" ).datepicker( "getDate" ).getFullYear();
		var selMonth=monthNames[$( "#datepicker" ).datepicker( "getDate" ).getMonth()];
		
		var selOpt=$("input[name='section']:checked").val();
		//https://www.nseindia.com/content/historical/EQUITIES/2017/MAR/cm24Mar2017bhav.csv.zip
		//var bhavurl="https://www.nseindia.com/content/historical/EQUITIES/"+selYear+"/"+selMonth+"/cm"+res+"bhav.csv.zip";
		
		// e.preventDefault();  //stop the browser from following
		
		
		
		var bhavurl=""
		if(selOpt=="equity"){
			bhavurl='/get-nse-bhavcopy-csv.php?date='+selDate+"-"+selMonth+"-"+selYear;
			
		}else if(selOpt=="fno"){
			bhavurl='/get-fno-nse-bhavcopy-csv.php?date='+selDate+"-"+selMonth+"-"+selYear;
		}
		window.location.href = bhavurl;
		
	    //alert( "Handler for .click() called." +bhavurl);
});








//To disable error alerts. Not recomended.
$.fn.dataTable.ext.errMode = 'none';


	
	function readBhavCSV(csvfile)
	
	
	{

		
		var table;
			
			Papa.parse(csvfile, {
				download: true,
				complete: function(results) {

				table =	$('#example').DataTable( {

			"pageLength": 2000,
			// "scrollX": true,		
					
					
					
		data: results.data,
		//SYMBOL,SERIES,OPEN,HIGH,LOW,CLOSE,LAST,PREVCLOSE,TOTTRDQTY,TOTTRDVAL,TIMESTAMP,TOTALTRADES,ISIN,
		"columns": [
           
	   	   { title: results.data[0][0] },
            { title: results.data[0][1] },
            { title: results.data[0][2] },
            { title: results.data[0][3] },
            { title: results.data[0][4] },
            { title: results.data[0][5] },
            { title: results.data[0][6] },
            { title: results.data[0][7] },
            { title: results.data[0][8] },
            { title: results.data[0][9] },
            { title: results.data[0][10] },
            { title: results.data[0][11] },
            { title: results.data[0][12] },
            { title: "high - open"},
            { title: "Low - open"},
            { title: "Change %"},
        ],
		
		
		"columnDefs": [ 
			{
				"targets": [ 9,10,12 ],
				"visible": false
			},			
		  {
			"targets": [ 0 ],
			"render": function ( data, type, full, meta ) {
				//console.log(full);
				  return data+'<a target="_blank" href="https://www.google.com/finance?q=NSE%3A'+data+'">G</a>'+'<a target="_blank"  href="http://chartink.com/stocks/'+data+'.html">C</a>';
			}
		  },
		    { //"high - open"
			//((high - open)/open)*100
			"targets": [ 13 ],
			"render": function ( data, type, full, meta ) {
				var val=(((Number(full[3])-Number(full[2]))/Number(full[2]))*100).toFixed(2);
				return '<span style="background:'+getColorForPercentage(val)+'">'+val+'</span>';
			}
		  }, 
		 
		 { //"low - open"
			//((low - open)/open)*100
		 
			"targets": [ 14 ],
			"render": function ( data, type, full, meta ) {
				var val=(((Number(full[4])-Number(full[2]))/Number(full[2]))*100).toFixed(2);
				return '<span style="background:'+getColorForPercentage(val)+'">'+val+'</span>';
			}
		  },
		 
		  { ////"Change %"
		  //((last - preclose)/preclose)*100
			"targets": [ 15 ],
			"render": function ( data, type, full, meta ) {
				var val=(((Number(full[6])-Number(full[7]))/Number(full[7]))*100).toFixed(2);
				return '<span style="background:'+getColorForPercentage(val)+'">'+val+'</span>';
			}
		  },
		 
		  
		  {
			"type": "html-num-fmt", "targets": [2,3,4,5,6,7,8,9,11,13,14,15],
			} 
		  
		]
	} );
	
	yadcf.init(table, [
		/*{column_number : 1},
		 {column_number : 5, filter_type: "range_number"}, */
		
		{
            column_number : 1, //close
            filter_container_id: 'external_filter_container_0'
        },
		{
            column_number : 5, //close
            filter_container_id: 'external_filter_container_1',
            filter_type: 'range_number'
        },
		
		{
            column_number : 8, //close
            filter_container_id: 'external_filter_container_2',
            filter_type: 'range_number'
        },
		
		{
            column_number : 11, //close
            filter_container_id: 'external_filter_container_3',
            filter_type: 'range_number'
        }
		
	]);
    
	yadcf.exFilterColumn(table, [[1, 'EQ'], [5, {from: 50, to: 500}], [11, {from: 10000}]]); //pre filter several columns
	
	}
	});
	}
	
	
	

	function readFNOBhavCSV(csvfile)
	{

		var table;
			
			Papa.parse(csvfile, {
				download: true,
				complete: function(results) {

				table =	$('#example').DataTable( {

			"pageLength": 2000,
			// "scrollX": true,		
					
					
					
		data: results.data,
		//SYMBOL,SERIES,OPEN,HIGH,LOW,CLOSE,LAST,PREVCLOSE,TOTTRDQTY,TOTTRDVAL,TIMESTAMP,TOTALTRADES,ISIN,
		
		
		
		"columns": [
           
		   { title: results.data[0][0] },
            { title: results.data[0][1] },
            { title: results.data[0][2] },
            { title: results.data[0][3] },
            { title: results.data[0][4] },
            { title: results.data[0][5] },
            { title: results.data[0][6] },
            { title: results.data[0][7] },
            { title: results.data[0][8] },
            { title: results.data[0][9] },
            { title: results.data[0][10] },
            { title: results.data[0][11] },
            { title: results.data[0][12] },
            { title: results.data[0][13] },
            { title: results.data[0][14] }
            /* { title: "high - open"},
            { title: "Low - open"},
            { title: "Change %"}, */
        ],
		
		"columnDefs": [ 
			{
				"targets": [ 14 ],
				"visible": false
			},

			{
			"type": "html-num-fmt", "targets": [3,5,6,7,8,9,11,13]
			}

			
			]
		
		
	} );
	
	
	//INSTRUMENT,SYMBOL,EXPIRY_DT,STRIKE_PR,OPTION_TYP,OPEN,HIGH,LOW,CLOSE,SETTLE_PR,CONTRACTS,VAL_INLAKH,OPEN_INT,CHG_IN_OI,TIMESTAMP,
	
	
	yadcf.init(table, [
		/*{column_number : 1},
		 {column_number : 5, filter_type: "range_number"}, */
		
		{
            column_number : 0, //INSTRUMENT
            filter_container_id: 'foexternal_filter_container_0'
        }
		
		 ,
		{
            column_number : 1, //SYMBOL
            filter_container_id: 'foexternal_filter_container_1'
        },
		
		{
            column_number : 2, //EXPIRY_DT
            filter_container_id: 'foexternal_filter_container_2'
        },
		
		{
            column_number : 3, //STRIKE_PR
            filter_container_id: 'foexternal_filter_container_3'
        },
		
		{
            column_number : 4, //OPTION_TYP
            filter_container_id: 'foexternal_filter_container_4'
        }  
	]);

	}
	
	});

	}
	
	

	
	/* $('#submit-parse').click(function() {
		var files = $('#files')[0].files;
		readBhavCSV(files[0]);
	}); */
	
	
	
	$('#loadbhav').click(function(e) {
		var str=$('#datepicker2').val();
		//cm24MAR2017bhav	
		var res = str.toUpperCase() ;
		var bhavurl="";
		
		var selOpt=$("input[name='section']:checked").val();
		if(selOpt=="equity"){
			bhavurl="data/bhavcopy/cm"+res+"bhav.csv";
			$('.eqfilter').show();
			readBhavCSV(bhavurl);
			
		}else if(selOpt=="fno"){
			bhavurl="data/bhavcopy/fo"+res+"bhav.csv";
			$('.fofilter').show();
			readFNOBhavCSV(bhavurl);
		}
	});


});
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	</script><!--  -->

	
		<style>
		table.dataTable thead th {
			padding: 10px 4px;
		}
		table.dataTable tbody td {
			padding: 2px;
		}

		.grid-container {
			 max-width: none; 
		}
		body {
			font-size: 12px;
		}

		.yadcf-filter{
		 width :50px;
		}
		.yadcf-filter-range-number-seperator{
		 display:none;
		}
		
		
		
		.eqfilter, .fofilter{
			display:none;
		}
		</style>

</head>
<body>

<div id="navSec"></div>

<div class="container">    




 <div class="row">
    <div class="col-sm-6">

<div>

<input type="radio" name="section" value="equity"> Equity<br>
<input type="radio" name="section" value="fno"> FNO<br>



</div><br>

</div>
</div>






    <div class="row">
    <div class="col-sm-6">
		<p>Date: <input type="text" id="datepicker"><button id="getbhav">Download BHAV</button></p>



<!-- <p>Select a file to upload*:</p> -->
		<!-- <form action="upload.php" method="post" enctype="multipart/form-data">
			
			<p><input type="file" name="fto" id="fto" style="float: left;">
			<input type="submit" value="Upload" name="submit"><em>*</em>(2.2 MB)</p> 
		</form> -->

	

    </div> <!-- -->
	<div class="col-sm-6">
	
	 <p>Date: <input type="text" id="datepicker2"><button id="loadbhav">Load BHAV</button></p> <!---->
		<!-- <p><input type="file" id="files" style="float:left;"><button id="submit-parse">Parse CSV</button></p> -->

	</div>
	
  </div>
  

			<div  class="row" id="externaly_triggered_wrapper" >
			<div class="col-sm-2 eqfilter">
	        	<span>Type:</span>
	        	<span id="external_filter_container_0"></span>
	        </div>
	        <div class="col-sm-2 eqfilter">
	        	<span>Close:</span>
	        	<span id="external_filter_container_1"></span>
	        </div>
  	        <div class="col-sm-2 eqfilter">
  	        	<span>Volume:</span>
	        	<span id="external_filter_container_2"></span>
	        </div>
	        <div class="col-sm-2 eqfilter">
	        	<span>Total Trades:</span>
	        	<span id="external_filter_container_3"></span>
	        </div>
			 
			
			
			
			
			<div class="col-sm-2 fofilter">
	        	<span>Instrument:</span>
	        	<span id="foexternal_filter_container_0"></span>
	        </div>
	        <div class="col-sm-2 fofilter">
	        	<span>Symbol:</span>
	        	<span id="foexternal_filter_container_1"></span>
	        </div>
  	        <div class="col-sm-2 fofilter">
  	        	<span>Expiry Date:</span>
	        	<span id="foexternal_filter_container_2"></span>
	        </div>
	        <div class="col-sm-2 fofilter">
	        	<span>Strike Price:</span>
	        	<span id="foexternal_filter_container_3"></span>
	        </div>
			 <div class="col-sm-2 fofilter">
	        	<span>Option Type:</span>
	        	<span id="foexternal_filter_container_4"></span>
	        </div>
			
			
			
			
	      </div>

  
  
  
  
  

  
  
  
  
  
  
  
  
  
  <div class="row">
  

  	  <div  class="table-responsive">
		<table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%"></table>
	  </div>
  </div>

</div>


<div id="footerSec"></div>

</body>
</html>
