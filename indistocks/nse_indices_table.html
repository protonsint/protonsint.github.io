<!DOCTYPE html>
<html lang="en">
<head>
  <title>IndiStocks - NSE Indices Table</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="js/init.js"></script>
  <link rel="stylesheet" href="css/style.css">
  
  <link href="https://cdn.datatables.net/1.10.13/css/jquery.dataTables.min.css" rel="stylesheet" />
  <script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script> -->
  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/init.js"></script>
  <link rel="stylesheet" href="css/style.css">
  
  <link href="css/jquery.dataTables.min.css" rel="stylesheet" />
  <script src="js/jquery.dataTables.min.js"></script> 
	
	
  
 <style>

table.dataTable tbody th, table.dataTable tbody td {
    padding: 0px;
}


</style>
</head>
<body>

<div id="navSec"></div>

<div class="container">    
  <div class="row">
    <div class="col-sm-12">

	<div class="table-responsive">
						<select name="bankNiftySelect" id="bankNiftySelect"  class="goodTextBox" style="width:210px;">                        	
                            <optgroup label="Broad Market Indices">
                            <option value="nifty">Nifty 50 </option>
                            <option value="juniorNifty"> Nifty Next 50 </option>
                            <!-- <option value="indiavix"> INDIA VIX </option> 
                            <option value="cnx100"> CNX 100</option>
                            <option value="defty"> S&P CNX DEFTY </option>
                            <option value="cnx500"> S&P CNX 500 </option> 
                            <option value="midcap"> CNX MIDCAP </option>-->
							<!-- <option value="nseliquid"> Nifty100 Liquid 15 </option> --> 
                            <option value="niftyMidcap50"> Nifty Midcap 50 </option>
							<!-- <option value="niftyMidcapLiq15"> Nifty Midcap Liquid 15 </option> -->
                            </optgroup>        
                            <optgroup label="Sectoral Indices">    
							<option value="cnxAuto">Nifty Auto</option>	
							<option value="bankNifty">Nifty Bank</option>
							<option value="cnxEnergy">Nifty Energy</option>
							<option value="cnxFinance">Nifty Financial Services</option>
							<option value="cnxFMCG">Nifty FMCG</option>
							<option value="cnxit">Nifty IT</option>
							<option value="cnxMedia">Nifty Media</option>
							<option value="cnxMetal">Nifty Metal</option>
							<option value="cnxPharma">Nifty Pharma</option>
							<option value="cnxPSU">Nifty PSU Bank</option>
							<option value="cnxRealty">Nifty Realty</option>
							<option value="niftyPvtBank">Nifty Private Bank</option>
							</optgroup>	
							<optgroup label="Thematic Indices">
							<option value="cnxCommodities">Nifty Commodities</option>
							<option value="cnxConsumption">Nifty India Consumption</option>
							<option value="cpse">Nifty CPSE</option>
							<option value="cnxInfra">Nifty Infrastructure</option>
							<option value="cnxMNC">Nifty MNC</option>
							<option value="ni15">Nifty Growth Sector 15</option>
							<option value="cnxPSE">Nifty PSE</option>
							<option value="cnxService">Nifty Services Sector</option>	
							<option value="nseliquid"> Nifty100 Liquid 15 </option>
							<option value="niftyMidcapLiq15"> Nifty Midcap Liquid 15 </option>
							</optgroup>
							<optgroup label="Strategy Indices">
							<option value="cnxDividendOppt">Nifty Dividend Opportunities 50</option>
							<option value="nv20">Nifty50 Value 20</option>
							<option value="niftyQuality30">Nifty Quality 30</option>
							</optgroup>
							<optgroup label="Others">
							<option value="foSec"> FO Stocks</option>
							<option value="etf"> ETF</option>
							<option value="goldEtf">Gold ETF</option>
							<option value="nifty50Etf">Nifty 50 ETF</option>
							<option value="iL">Institutional Stock Watch</option>
							<option value="cbmSecList">Bonds in CM</option>
							</optgroup>
                        </select>
	

			
	<table id="example" class="display" cellspacing="0" width="100%">   </table>		

	</div>
	
    </div>
  </div>
</div>

<div id="footerSec"></div>



<script>

var getColorForPercentage = function(pct) {
	var cfac=(Math.abs(pct)/5);
	var ccode=0;
	if(pct<0)
		ccode='rgba(255,0,0,'+cfac+')';
	else
		ccode='rgba(0,255,0,'+cfac+')';

	return ccode;
}
		


$(document).ready(function(){

	
var proxyUrl='/ba-proxy.php?url=';
var table;
function changeNiftyView(){

		var contUrl='https://www.nseindia.com/live_market/dynaContent/live_watch/stock_watch/'+$( "#bankNiftySelect" ).val()+'StockWatch.json';

		$.ajax({
		   type: 'GET',
		   url:proxyUrl+encodeURIComponent(contUrl),
		   dataType: "json",
		   
		   success: function(data){
		   
		  table =  $('#example').DataTable( {
				data: data.contents.data,
				"destroy": true,
				"pageLength": 250,
				columns: [
					{ data: 'symbol', title: 'Symbol'},
					{ data: 'open' , title: 'Open'},
					{ data: 'high' , title: 'High'},
					{ data: 'low' , title: 'Low'},
					{ data: 'ltP' , title: 'Last'},
					{ data: 'ptsC' , title: 'Change'},
					{ data: 'per' , title: 'Change %'},
					{ data: 'trdVol' , title: 'Vol (lacs)'},
					/*{ data: 'trdVolM' , title: 'trdVolM'}, */
					{ data: 'ntP' , title: 'Value (Crs)'},
					/*{ data: 'mVal' , title: 'Value (M)'},*/
					{ data: 'wkhi' , title: 'wkhi'},
					{ data: 'wklo' , title: 'wklo'},
					/*{ data: 'wkhicm_adj' , title: 'wkhicm_adj'},
					{ data: 'wklocm_adj' , title: 'wklocm_adj'},
					{ data: 'cAct' },*/
					{ data: 'mPC' , title: 'Month %'},
					{ data: 'yPC' , title: 'Year %'},
					{ title: 'Low %'},
					{ title: 'High %'},

					{ title: '52wk %'}
				],
				
				"columnDefs": [ 
			/*{
				"targets": [ 0,9,11,12 ],
				"visible": false
			},		*/	
		  {
			"targets": [ 0 ],
			"render": function ( data, type, full, meta ) {
				  return data+'<u><a target="_blank" title="Google Finance" href="https://www.google.com/finance?q=NSE%3A'+data+'">g</a>|'+'<a target="_blank" title="Chartink"  href="http://chartink.com/stocks/'+data+'.html">c</a>|'+'<a target="_blank" title="Screener"  href="https://www.screener.in/company/'+data+'">s</a>|</u>';
			}
		  }
		  
		  
		  ,{
			"targets": [ 6 ],
			"render": function ( data, type, full, meta ) {
				  return '<span style="background:'+getColorForPercentage(data)+'">'+data+'</span>';
			}
		  }
		  
		  
		  ,{
			"targets": [ 13 ],
			"render": function ( data, type, full, meta ) {
			var openv=Number(full.open.replace(',', ''));
			var lowv=Number(full.low.replace(',', ''));
			var val=(((lowv-openv)/openv)*100).toFixed(2);
				  return '<span style="background:'+getColorForPercentage(val)+'">'+val+'</span>';
			}
		  }
		  
		  ,{
			"targets": [ 14 ],
			"render": function ( data, type, full, meta ) {
			var openv=Number(full.open.replace(',', ''));
			var highv=Number(full.high.replace(',', ''));
			var val=(((highv-openv)/openv)*100).toFixed(2);
				  return '<span style="background:'+getColorForPercentage(val)+'">'+val+'</span>';
			}
		  }
                 ,{
			"targets": [ 15 ],
			"render": function ( data, type, full, meta ) {
			var wkhiv=Number(full.wkhi.replace(',', ''));
			var wklov=Number(full.wklo.replace(',', ''));
			var wklast=Number(full.ltP.replace(',', ''));


			var val=(((wklast-wklov)/(wkhiv-wklov))*100).toFixed(2);
console.log(wkhiv,wklov, wklast, val);
				  return '<span>'+val+'</span>';
			}
		  }


		  
		]
		
		
			} );


		   
		   },
		   error: function(jqXHR, textStatus, errorThrown) {
			alert(textStatus)
			  // error_fn(jqXHR, textStatus, errorThrown);
		   }
		});
}

          changeNiftyView();
	$( "#bankNiftySelect" ).change( changeNiftyView );

	});
	</script>

</body>
</html>
